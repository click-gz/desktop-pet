# 更新日志 (Changelog)

本文档记录了桌面宠物项目的所有重要变更。

## [v2.0] - 2024-12-18

### ✨ 新增功能

#### 完善的能量系统 v2.0
- **差异化能量消耗**：待机状态1小时耗尽，兴奋状态40分钟耗尽，睡眠状态不消耗
- **移动能量消耗**：基于移动距离的动态消耗（2%-5%），能量不足时无法移动
- **智能恢复机制**：点击恢复1%能量（2秒冷却），睡眠时每10秒恢复1%
- **强制睡眠机制**：能量为0时强制进入睡眠状态
- **能量等级显示**：5个等级（极低、很低、低、中等、充满）
- **视觉反馈**：低能量时动作变慢、透明度降低、轻微去色

#### 智能移动系统
- **自动移动**：兴奋状态下5秒无交互自动移动到鼠标位置
- **全局鼠标跟踪**：支持跨屏幕的精确鼠标位置获取
- **移动边界检查**：防止宠物移动出屏幕边界
- **移动能量消耗**：移动会消耗相应能量，增加策略性

#### 状态颜色系统
- **待机状态**：粉红色渐变 (radial-gradient(circle, #ff9999 20%, #ff6b6b 40%, #ee5a24 60%))
- **兴奋状态**：黄橙色渐变 (radial-gradient(circle, #ffeaa7 20%, #fdcb6e 40%, #e17055 60%))
- **睡觉状态**：绿色渐变 (radial-gradient(circle, #a8e6cf 20%, #88d8a3 40%, #66bb6a 60%))

#### 睡眠指示器
- **"zzZ"动画**：独立HTML元素实现的睡眠指示器
- **位置优化**：显示在宠物右上方，不使用CSS content属性

### 🔧 性能优化

#### 拖拽性能优化
- **节流机制**：使用setTimeout限制拖拽更新频率为16ms间隔(60fps)
- **重影问题修复**：优化事件处理，减少拖拽残影
- **内存优化**：优化dragThrottleTimeout变量管理

#### 菜单优化
- **紧凑设计**：减小内边距（6px 12px）、字体（11px）和行高（1.2）
- **滚动支持**：最大高度300px，支持垂直滚动
- **美观滚动条**：自定义滚动条样式，宽度4px，圆角设计
- **防截断**：长菜单不会被系统边界截断

### 🐛 问题修复

#### 编码问题修复
- **Windows中文编码**：在package.json启动脚本中添加chcp 65001命令
- **控制台乱码**：移除不兼容的process.stdout.setEncoding设置
- **中文显示**：确保所有中文文本正确显示

#### 功能修复
- **隐藏功能**：修复右键菜单隐藏功能失效问题，添加hide-window IPC处理器
- **状态切换**：移除自动状态切换，确保所有状态变更由用户手动触发
- **鼠标位置**：修复移动位置不准确问题，改进坐标转换算法

#### 托盘图标优化
- **兼容性增强**：使用nativeImage.createFromPath()替代直接路径加载
- **多格式支持**：支持ICO和PNG格式，提供多重备用方案
- **错误处理**：完善的错误处理机制，确保托盘功能稳定

### 🎨 UI/UX 改进

#### 视觉效果增强
- **状态指示**：详细的能量状态检查功能，显示消耗率和剩余时间
- **动画优化**：能量影响动画速度，低能量时动作变慢
- **透明度反馈**：低能量时宠物透明度降低，提供视觉反馈

#### 菜单改进
- **功能完善**：新增"⚡ 能量"和"🐱 唤醒"菜单项
- **文本优化**：简化菜单项文本，提高可读性
- **响应优化**：确保菜单项点击响应稳定可靠

### 🏗️ 架构改进

#### 模块化设计
- **状态管理**：完善的状态模式实现，清晰的状态转换逻辑
- **能量系统**：独立的能量管理模块，支持扩展
- **行为系统**：可配置的行为参数，易于调整

#### 代码质量
- **注释完善**：添加详细的中文注释，提高代码可读性
- **错误处理**：完善的错误处理和日志输出
- **性能监控**：添加性能相关的调试信息

## [v1.0] - 2024-12-17

### ✨ 初始功能
- 🐱 基础桌面宠物显示
- 🎮 三种状态：待机、兴奋、睡觉
- 🎨 基础动画效果
- 🖱️ 点击和拖拽交互
- 🗂️ 右键菜单功能
- 🔔 系统托盘集成

---

**版本说明**：
- 遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范
- 每个版本包含功能描述、修复内容和改进点
- 详细的技术实现说明帮助开发者理解变更